<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attendance Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-50 min-h-screen p-4">
    <div class="max-w-2xl mx-auto">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">üìã Attendance Tracker</h1>
            
            <div id="successMsg" style="display: none;" class="mb-6 p-4 bg-green-100 border-2 border-green-500 rounded-lg text-green-800 font-semibold text-center">
                ‚úÖ Attendance Recorded Successfully!
            </div>
            
            <div id="errorMsg" style="display: none;" class="mb-6 p-4 bg-red-100 border-2 border-red-500 rounded-lg text-red-800 font-semibold text-center">
                ‚ùå <span id="errorText">Error occurred</span>
            </div>
            
            <div class="space-y-5">
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">üë§ Employee Name *</label>
                    <select id="employeeName" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg">
                        <option value="">-- Select Your Name --</option>
                        <option value="Employee 1">Employee 1</option>
                        <option value="Employee 2">Employee 2</option>
                        <option value="Employee 3">Employee 3</option>
                        <option value="Employee 4">Employee 4</option>
                        <option value="Employee 5">Employee 5</option>
                        <option value="Employee 6">Employee 6</option>
                        <option value="Employee 7">Employee 7</option>
                        <option value="Employee 8">Employee 8</option>
                        <option value="Employee 9">Employee 9</option>
                        <option value="Employee 10">Employee 10</option>
                        <option value="Employee 11">Employee 11</option>
                        <option value="Employee 12">Employee 12</option>
                        <option value="Employee 13">Employee 13</option>
                        <option value="Employee 14">Employee 14</option>
                        <option value="Employee 15">Employee 15</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">üìä Status *</label>
                    <select id="status" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg">
                        <option value="">-- Select Status --</option>
                        <option value="Present - Office">Present - Office</option>
                        <option value="Work From Home">Work From Home</option>
                        <option value="Sick Leave">Sick Leave</option>
                        <option value="Vacation">Vacation</option>
                        <option value="Personal Leave">Personal Leave</option>
                        <option value="Half Day">Half Day</option>
                    </select>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">üìç Location *</label>
                    <button id="locationBtn" type="button" class="w-full bg-blue-600 text-white px-6 py-4 rounded-lg text-lg font-bold hover:bg-blue-700">
                        <span id="locationBtnText">Click to Get Location</span>
                    </button>
                    <div id="locationInfo" style="display: none;" class="mt-3 p-4 bg-green-50 border-2 border-green-300 rounded-lg">
                        <p class="text-sm font-semibold">‚úÖ Location Captured!</p>
                        <p class="text-sm mt-1"><strong>Coordinates:</strong> <span id="coords"></span></p>
                        <p class="text-sm"><strong>Address:</strong> <span id="addr"></span></p>
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-2">üìù Notes (Optional)</label>
                    <textarea id="notes" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg" rows="3" placeholder="Any additional comments..."></textarea>
                </div>

                <button id="submitBtn" class="w-full bg-green-600 text-white px-6 py-5 rounded-lg text-xl font-bold hover:bg-green-700 mt-4">
                    <span id="submitText">‚úì SUBMIT ATTENDANCE</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw4blMS4G_mIhNLi2o_TUDo6dWwqaJ2c-Cb6BXiWzLu_0Mm-VLdiHv7QnsRjOsunDWc/exec';
        let locationData = null;

        function showError(msg) {
            document.getElementById('errorText').textContent = msg;
            document.getElementById('errorMsg').style.display = 'block';
            document.getElementById('successMsg').style.display = 'none';
            setTimeout(() => {
                document.getElementById('errorMsg').style.display = 'none';
            }, 5000);
        }

        function showSuccess() {
            document.getElementById('successMsg').style.display = 'block';
            document.getElementById('errorMsg').style.display = 'none';
            setTimeout(() => {
                document.getElementById('successMsg').style.display = 'none';
            }, 5000);
        }

        document.getElementById('locationBtn').onclick = function() {
            const btn = this;
            const btnText = document.getElementById('locationBtnText');
            
            btnText.textContent = '‚è≥ Getting location...';
            btn.disabled = true;
            btn.style.opacity = '0.6';
            
            if (!navigator.geolocation) {
                showError('Your browser does not support location services');
                btnText.textContent = 'Click to Get Location';
                btn.disabled = false;
                btn.style.opacity = '1';
                return;
            }
            
            navigator.geolocation.getCurrentPosition(
                async function(position) {
                    locationData = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    document.getElementById('coords').textContent = 
                        locationData.lat.toFixed(6) + ', ' + locationData.lng.toFixed(6);
                    
                    try {
                        const res = await fetch(
                            'https://nominatim.openstreetmap.org/reverse?format=json&lat=' + 
                            locationData.lat + '&lon=' + locationData.lng
                        );
                        const data = await res.json();
                        locationData.address = data.display_name || 'Address not available';
                        document.getElementById('addr').textContent = locationData.address;
                    } catch (err) {
                        locationData.address = 'Could not fetch address';
                        document.getElementById('addr').textContent = locationData.address;
                    }
                    
                    document.getElementById('locationInfo').style.display = 'block';
                    btnText.textContent = '‚úÖ Location Captured';
                    btn.style.backgroundColor = '#16a34a';
                    btn.disabled = false;
                    btn.style.opacity = '1';
                },
                function(error) {
                    showError('Could not get location. Please enable location permissions.');
                    btnText.textContent = 'Click to Get Location';
                    btn.disabled = false;
                    btn.style.opacity = '1';
                }
            );
        };

        document.getElementById('submitBtn').onclick = function() {
            const name = document.getElementById('employeeName').value;
            const status = document.getElementById('status').value;
            const notes = document.getElementById('notes').value;
            const submitBtn = this;
            const submitText = document.getElementById('submitText');
            
            if (!name) {
                showError('Please select your name');
                return;
            }
            if (!status) {
                showError('Please select status');
                return;
            }
            if (!locationData) {
                showError('Please capture your location first');
                return;
            }
            
            submitBtn.disabled = true;
            submitText.textContent = '‚è≥ Submitting...';
            submitBtn.style.opacity = '0.6';
            
            const now = new Date();
            const payload = {
                name: name,
                status: status,
                date: now.toLocaleDateString('en-US'),
                time: now.toLocaleTimeString('en-US'),
                latitude: locationData.lat,
                longitude: locationData.lng,
                address: locationData.address,
                notes: notes
            };
            
            const formData = new FormData();
            formData.append('data', JSON.stringify(payload));
            
            fetch(SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.text())
            .then(data => {
                showSuccess();
                
                document.getElementById('employeeName').value = '';
                document.getElementById('status').value = '';
                document.getElementById('notes').value = '';
                locationData = null;
                document.getElementById('locationInfo').style.display = 'none';
                document.getElementById('locationBtnText').textContent = 'Click to Get Location';
                document.getElementById('locationBtn').style.backgroundColor = '#2563eb';
                
                submitBtn.disabled = false;
                submitText.textContent = '‚úì SUBMIT ATTENDANCE';
                submitBtn.style.opacity = '1';
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            })
            .catch(error => {
                console.error('Error:', error);
                showError('Failed to submit. Please try again.');
                submitBtn.disabled = false;
                submitText.textContent = '‚úì SUBMIT ATTENDANCE';
                submitBtn.style.opacity = '1';
            });
        };
    </script>
</body>
</html>
